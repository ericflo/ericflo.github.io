
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Eric Florenzano's Blog</title>
  <meta name="author" content="Eric Florenzano">

  
  <meta name="description" content="Firstly, my apologies to any technical readers of this blog, as this post is mostly personal. Iowa State University
For the past four years, I have &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ericflo.github.com/blog/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Eric Florenzano's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1959803-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Eric Florenzano's Blog</a></h1>
  
    <h2>I am me.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ericflo.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/06/06/where-ive-been-and-where-im-going/">Where I&#8217;ve Been, and Where I&#8217;m Going</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-06-06T00:43:28-07:00" pubdate data-updated="true">Jun 6<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Firstly, my apologies to any technical readers of this blog, as this post is mostly personal.</p>
<div class="section" id="iowa-state-university">
<h2>Iowa State University</h2>
<p>For the past four years, I have attended <a class="reference external" href="http://www.iastate.edu/">Iowa State University</a>, pursuing a Bachelors of Science in Computer Science.  Finally last month, that process was over.  Degree in hand, I can&#8217;t help but think back about all of the truly great memories, experiences, and new friends that were made possible by going to <a class="reference external" href="http://www.iastate.edu/">Iowa State</a>.  Not only was the extracurricular experience great, but at the same time, I feel like the education was top-notch as well.  For anyone that knocks state schools, tell them to try to keep up in my Essentials of Programming Languages class with Professor Lumpe.</p>
</div>
<div class="section" id="tokyo-japan">
<h2>Tokyo, Japan</h2>
<p>I recognize that this point in my life is the last time (for a while, at least) that I&#8217;ll be able to do something crazy and go to a foreign country for two weeks.  The logical choice would have been to go to France, since I minored in French and know some people who live there.  That&#8217;s why I didn&#8217;t do that.  Instead, I&#8217;m doing something that I&#8217;ve always wanted to do, but never have: go to Japan.</p>
<p>I know there are some <a class="reference external" href="http://www.youtube.com/watch?v=BE35onlIySk">crazy things</a> going on all the time in Japan, and honestly that&#8217;s what&#8217;s so exciting to me.  It&#8217;s a completely different culture from our own and up until now I&#8217;ve only had glimpses into that culture.  I&#8217;ll have a ton more to say about this after the trip is done, along with a dizzying amount of pictures, so stay tuned for that if you&#8217;re at all interested.</p>
</div>
<div class="section" id="mochi-media">
<h2>Mochi Media</h2>
<p>I have accepted a position at <a class="reference external" href="http://www.mochimedia.com/">Mochi Media</a>, where I&#8217;ll be working with some ridiculously smart and talented people.  Not only that, but I get to use my favorite technologies, like <a class="reference external" href="http://www.python.org/">Python</a> and <a class="reference external" href="http://www.erlang.org/">Erlang</a>.  In the case of <a class="reference external" href="http://www.erlang.org/">Erlang</a>, Mochi Media is actively pioneering its use in the web space with its open source project <a class="reference external" href="http://code.google.com/p/mochiweb/">mochiweb</a> (most recently noted for being a key component in Facebook&#8217;s chat feature).  Contributing to open source, using languages that I like, pioneering the use of established technology in new ways, working with smart people, and having a great business model to boot.  All of that combined makes me one hell of an excited guy!</p>
<p>More practically, what this means is that I&#8217;m moving to San Francisco!  Hopefully there&#8217;ll be more Pythonistas there than there was in Iowa.  Whether there are or not, one thing is certain: there&#8217;ll be a lot more to do.</p>
<p>I&#8217;m a bit bored right now, and it&#8217;s a feeling I&#8217;m going to savor, because starting next week and into the foreseeable future, boredom is not a feeling I&#8217;ll be having much at all.</p>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/27/friendfeed-comment-expand-bookmarklet/">FriendFeed Comment Expand Bookmarklet</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-27T00:47:57-07:00" pubdate data-updated="true">May 27<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&#8217;ve been using a lot of <a class="reference external" href="http://friendfeed.com/">FriendFeed</a> lately, and found it a bit annoying to expand comments one-by-one, so I wrote a quick bookmarklet to automatically expand all comments out.</p>
<p>Drag this bookmarklet to your bookmarks toolbar to get in on the action:</p>
<p><a class="reference external" href="javascript:(function(A){A.parents(&quot;.commentexpander&quot;).hide();A.parents(&quot;.comments&quot;).show().find(&quot;.hiddencomments&quot;).show(100)})(jQuery('.l_showcomments'))">Show All Comments</a></p>
<p>By the way, feel free to <a class="reference external" href="http://friendfeed.com/ericflo">follow me</a> on FriendFeed as well to see my various online activities.  I&#8217;m in the habit of following people who follow me.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/24/managers-and-voting-and-subqueries-oh-my/">Managers and Voting and Subqueries, Oh My!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-24T16:12:19-07:00" pubdate data-updated="true">May 24<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I launched <a class="reference external" href="http://peevalizer.com/">Peevalizer</a>, a website for talking about your pet peeves, which of course was written in Python using the Django web framework.  In fact, it was the culmination of my efforts to <a class="reference external" href="http://www.eflorenzano.com/blog/post/learning-design/">teach myself design</a>, and while I made some progress, it&#8217;s clear that I&#8217;ll never be a designer.  Anyway, part of <a class="reference external" href="http://peevalizer.com/">Peevalizer</a> is that users can vote on different pet peeves, and view the peeves with the highest score.  I used <a class="reference external" href="http://code.google.com/p/django-voting/">django-voting</a> as the application to enable this functionality, and it provides a manager on the <tt class="docutils literal">Vote</tt> object with methods for getting the top N results, where N is a positive integer.</p>
<p>One of the reasons for custom manager on <tt class="docutils literal">Vote</tt> is because <a class="reference external" href="http://code.google.com/p/django-aggregation/">aggregate support</a> has not yet been finished.  However with Django&#8217;s built-in <a class="reference external" href="http://www.djangoproject.com/documentation/pagination/">Pagination</a> support, it&#8217;s necessary to retrieve not only a list of the top N voted pet peeves, but a list of all of the pet peeves, ordered by score.  How is this possible?  Specifically, how is this possible without forking <a class="reference external" href="http://code.google.com/p/django-voting/">django-voting</a>?  Here is the solution that I came up with:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">VoteAwareManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">_get_score_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">model_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
</span><span class="line">        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="p">{</span>
</span><span class="line">            <span class="s">&#39;score&#39;</span><span class="p">:</span> <span class="s">&#39;SELECT COALESCE(SUM(vote),0) FROM </span><span class="si">%s</span><span class="s"> WHERE content_type_id=</span><span class="si">%d</span><span class="s"> AND object_id=</span><span class="si">%s</span><span class="s">.id&#39;</span> <span class="o">%</span>
</span><span class="line">                <span class="p">(</span><span class="n">Vote</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">model_type</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">table_name</span><span class="p">)}</span>
</span><span class="line">        <span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">most_hated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_score_annotation</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-score&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">most_loved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_score_annotation</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure><p>Then I assigned that manager onto all of the objects that could be voted on.  What that&#8217;s doing is literally issuing a subquery for every row, doing an aggregate on all of the votes for that row, and assigning it to an attribute named <em>score</em>.</p>
<p>However, we also wanted to allow for voting on <tt class="docutils literal">User</tt> objects, which is built in to Django and cannot be easily changed.  How do we add this manager to user?  I spent a while thinking about that before realizing that it&#8217;s not the right question to ask.  The right question to ask is, how can we associate the <tt class="docutils literal">User</tt> model with this manager?  A quick look through some Django source code revealed this to be an absolutely trivial task.  Here&#8217;s how it goes in our code:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class="line"><span class="n">manager</span> <span class="o">=</span> <span class="n">VoteAwareManager</span><span class="p">()</span>
</span><span class="line"><span class="n">manager</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
</span><span class="line">
</span><span class="line"><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">manager</span><span class="o">.</span><span class="n">most_hated</span><span class="p">():</span>
</span><span class="line">    <span class="c"># Do something with user&#39;s score</span>
</span></code></pre></td></tr></table></div></figure><p>There are a few things to note about this implementation.  Firstly, it can be much more computationally expensive to use this method instead of using <a class="reference external" href="http://code.google.com/p/django-voting/">django-voting</a>&#8217;s method (which executes some custom SQL), so either be aware of that or use aggressive caching strategies to overcome this shortcoming.  The other thing is if you&#8217;re not using a manager like this on multiple models, and since managers mostly just proxy to <tt class="docutils literal">QuerySet</tt> anyway, it might be simpler to just acquire a <tt class="docutils literal">QuerySet</tt> on the model that you would like to get, and run the <tt class="docutils literal">extra()</tt> method in the calling function.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/17/exploring-mixins-django-model-inheritance/">Exploring Mixins With Django Model Inheritance</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-17T00:24:03-07:00" pubdate data-updated="true">May 17<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a class="reference external" href="http://www.djangoproject.com/">Django</a> now supports <a class="reference external" href="http://www.djangoproject.com/documentation/model-api/#model-inheritance">Model Inheritance</a>, and one of the coolest new opportunities that model inheritance brings is the possibility of the creation of <a class="reference external" href="http://en.wikipedia.org/wiki/Mixin">mixins</a>, so in this post I&#8217;ll walk through the steps I went through to create some simple examples. This is just an excercise (although it could be modified to be more robust)&#8211;and right now there are better ways to achieve all of the effects of the following mixins.  (See <a class="reference external" href="http://code.google.com/p/django-mptt/">django-mptt</a>, for example).</p>
<div class="section" id="model-and-field-setup">
<h2>Model and Field Setup</h2>
<p>First let&#8217;s just set up two basic models.  The first will be our mixin, <tt class="docutils literal">NaiveHierarchy</tt>, which has a single field, <tt class="docutils literal">parent</tt>, which is a reference to itself.  Using this, we can traverse the tree and find all sorts of fun hierarchical information.  Also, we&#8217;ll create the canonical example model: the blog post.  Our models start out looking something like this:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchy</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">NaiveHierarchy</span><span class="p">):</span>
</span><span class="line">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span></code></pre></td></tr></table></div></figure><p>Now let&#8217;s test to make sure that worked.  We&#8217;ll create some data and test that <tt class="docutils literal">parent</tt> exists on the instances.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="pycon"><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mixins.models</span> <span class="kn">import</span> <span class="n">BlogPost</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;post1&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;First post!&quot;</span><span class="p">)</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;post2&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;Second post!&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">bp</span><span class="p">)</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp3</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;post3&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;Third post!&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">bp2</span><span class="p">)</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">parent</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span><span class="o">.</span><span class="n">parent</span>
</span><span class="line"><span class="go">&lt;BlogPost: post1&gt;</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="inherited-class-level-methods">
<h2>Inherited Class-Level Methods</h2>
<p>So as you can see, everything is working correctly!  But that really doesn&#8217;t save us much time yet, as it&#8217;s fairly easy to copy and paste fields onto new models, and we still have to write methods which take advantage of those new fields.  In this case, I already know that I&#8217;m going to want to get the related children and descendants of my blogposts.  So why not write those methods on the abstract model?  Thanks to inheritance, those methods will apply to the new model as well.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchy</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">descs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">())</span>
</span><span class="line">        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">descs</span><span class="p">):</span>
</span><span class="line">            <span class="n">descs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">())</span>
</span><span class="line">        <span class="k">return</span> <span class="n">descs</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</span></code></pre></td></tr></table></div></figure><p>Now, getting all the children or descendents of a particular node is easy:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="pycon"><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
</span><span class="line"><span class="go">[&lt;BlogPost: post2&gt;]</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">()</span>
</span><span class="line"><span class="go">set([&lt;BlogPost: post2&gt;, &lt;BlogPost: post3&gt;])</span>
</span></code></pre></td></tr></table></div></figure><p>Now this <tt class="docutils literal">NaiveHierarchy</tt> mixin is starting to become quite useful!  But what happens if I want to get all of the BlogPosts that have no parents?  It&#8217;s really manager-level functionality.  So let&#8217;s write a manager which defines a <tt class="docutils literal">get_roots</tt> function.  Unfortunately, using abstract managers doesn&#8217;t quite work yet (it works for non-abstract inheritance), but it probably will in future versions of Django.  In fact, by applying the latest patch on either Django ticket <a class="reference external" href="http://code.djangoproject.com/ticket/7252">7252</a> or <a class="reference external" href="http://code.djangoproject.com/ticket/7154">7154</a>, it will work today. Let&#8217;s see how this would look:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchyManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">get_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchy</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="n">tree</span> <span class="o">=</span> <span class="n">NaiveHierarchyManager</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">descs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">())</span>
</span><span class="line">        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">descs</span><span class="p">):</span>
</span><span class="line">            <span class="n">descs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">())</span>
</span><span class="line">        <span class="k">return</span> <span class="n">descs</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">NaiveHierarchy</span><span class="p">):</span>
</span><span class="line">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span></code></pre></td></tr></table></div></figure><p>Note that we needed to explicitly define objects as the basic manager, because once a parent class specifies a manager, it gets set as the default manager on all inherited subclasses.  This would play out exactly how you would expect:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="pycon"><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">BlogPost</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_roots</span><span class="p">()</span>
</span><span class="line"><span class="go">[&lt;BlogPost: post1&gt;]</span>
</span><span class="line"><span class="gp">&gt;&gt;&gt; </span><span class="n">BlogPost</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="line"><span class="go">[&lt;BlogPost: post1&gt;, &lt;BlogPost: post2&gt;, &lt;BlogPost: post3&gt;]</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="advanced-stuff">
<h2>Advanced Stuff</h2>
<p>So now I really wanted to push the limit, and write a mixin which would enhance one of the basic methods of all <tt class="docutils literal">Model</tt> classes: <tt class="docutils literal">save()</tt>.  This would be a DateMixin which would contain <tt class="docutils literal">date_added</tt> and <tt class="docutils literal">date_modified</tt>, where <tt class="docutils literal">date_modified</tt> was updated on each save.  To my surprise, this <em>Just Worked</em>.  Let&#8217;s see the final result:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">DateMixin</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">date_added</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span><span class="line">    <span class="n">date_modified</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">date_modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class="line">        <span class="nb">super</span><span class="p">(</span><span class="n">DateMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchyManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">get_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">NaiveHierarchy</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="line">    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="n">tree</span> <span class="o">=</span> <span class="n">NaiveHierarchyManager</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_manager</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">get_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="n">descs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">())</span>
</span><span class="line">        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">descs</span><span class="p">):</span>
</span><span class="line">            <span class="n">descs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">())</span>
</span><span class="line">        <span class="k">return</span> <span class="n">descs</span>
</span><span class="line">
</span><span class="line">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="line">        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">NaiveHierarchy</span><span class="p">,</span> <span class="n">DateMixin</span><span class="p">):</span>
</span><span class="line">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span>
</span><span class="line">    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="conclusions">
<h2>Conclusions</h2>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Mixin">Mixins</a> can be powerful tools, but there are some hazards in using mixins, which all boil down to the same basic problem:  unexpected consequences.  In the case of the <tt class="docutils literal">DateMixin</tt>, if any other class has defined a <tt class="docutils literal">save()</tt> method, our custom <tt class="docutils literal">save()</tt> method simply won&#8217;t be called unless called explicitly.  Perhaps this is a documentation problem, but perhaps it&#8217;s a fault in the idea of a date mixin altogether.</p>
<p>So all that being said, I&#8217;m not suggesting to go off and start using any of the mixins that I have provided here, but rather to illustrate how a mixin can be constructed with <a class="reference external" href="http://www.djangoproject.com/">Django</a>&#8217;s new <a class="reference external" href="http://www.djangoproject.com/documentation/model-api/#model-inheritance">Model Inheritance</a>.  I do hope that a reusable app emerges with some great mixins that are useful for a large variety of tasks.  Because mixins are powerful, and new shiny things that Django can do, and new shiny things are worth being explored!</p>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/15/revolutionary-ideas/">Revolutionary Ideas</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-15T09:18:44-07:00" pubdate data-updated="true">May 15<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Everyone has had the experience of hearing about something new and thinking: &quot;That makes so much sense!  Why didn&#8217;t I think of that?&quot;  For programmers that keep up on open source software, new projects that fit the previous description attract not only our admiration, but we want to be a part of this new idea.  We become involved and contribute and try to push that new software into any new direction that we can; learning from it and evolving it along the way.</p>
<p>One such idea that fits my description perfectly is <a class="reference external" href="http://ejohn.org/blog/processingjs/">Processing.js</a>.  Not to belittle <a class="reference external" href="http://ejohn.org/">John Resig</a>&#8217;s hard work in actually developing the initial codebase, but the <strong>idea</strong> is what is so much more important.  Thousands of developers knew of both the <a class="reference external" href="http://processing.org/">Processing language</a> and about the <a class="reference external" href="http://en.wikipedia.org/wiki/Canvas_(HTML_element)">canvas tag</a> which is coming to prevalence, but it was a revolutionary idea to notice that the pairing of the two was &quot;both possible and desirable to do in the first place&quot;, as <a class="reference external" href="http://reddit.com/">Reddit</a> commenter <a class="reference external" href="http://reddit.com/user/MarshallBanana/">MarshallBanana</a> <a class="reference external" href="http://reddit.com/info/6ipvz/comments/c03ygkq">pointed out</a>.</p>
<p>As a community we need both the revolutionary ideas and the evolutionary changes so that we get great software that solves problems in new and innovative ways, but also that doesn&#8217;t have bugs and provides a polished experience.  But I think that we&#8217;ve become too bogged down in the evolutionary.  We get so wrapped up in others&#8217; ideas&#8211;so interested in polish and shine&#8211;that seldom few think outside the boundary of the incremental.  I won&#8217;t claim to be the exception here, and rightly can&#8217;t claim to be, but it&#8217;s something that&#8217;s worrisome nonetheless.</p>
<p>I think that a big part of it is that the open source community has gotten so wary of experimentation with well-established applications.  Why can&#8217;t a development version of Firefox include a Python or Ruby interpreter alongside a JavaScript interpreter?  Why can&#8217;t CSS directives for reflections be explored, or animations be built into the rendering engine?  I think that a big part of it is because we&#8217;ve spent so long talking about validation and standards that we forgot about that sense of wonder; that feeling of anything being possible with a bit of code and enthusiasm.</p>
<p><a class="reference external" href="http://ejohn.org/blog/processingjs/">Processing.js</a>, and projects like it, give me hope that revolutionary ideas are still out there.  They rekindle that sense of wonder in me.  They make me think about other things that are possible.  They make me excited about open source again.  Let&#8217;s foster more and greater and better ideas, and just once in a while, eschew the incremental.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/06/my-awesome-regex-snippet/">My Awesome Regex Snippet</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-06T01:24:07-07:00" pubdate data-updated="true">May 6<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There are many times when the programming task at hand is to iterate over some semi-structured text, transform parts of that text in some way, and reintegrate those transformed parts back into the original text.</p>
<p>Typically using a regular expression with re.sub and a callback function, but sometimes you want a bit more control of the process (especially over those parts that <em>dont</em> match the regex). Usually my solution is to write a one-off function that does it, but today I had to write that function yet again and decided to generalize it and post it here.</p>
<p>To be completely honest, this post is more for my own archival purposes than for the internet as a whole, but if anyone else finds it useful, then I&#8217;m ecstatic.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">re_parts</span><span class="p">(</span><span class="n">regex_list</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="line"><span class="sd">    An iterator that returns the entire text, but split by which regex it</span>
</span><span class="line"><span class="sd">    matched, or none at all.  If it did, the first value of the returned tuple</span>
</span><span class="line"><span class="sd">    is the index into the regex list, otherwise -1.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    &gt;&gt;&gt; first_re = re.compile(&#39;asdf&#39;)</span>
</span><span class="line"><span class="sd">    &gt;&gt;&gt; second_re = re.compile(&#39;an&#39;)</span>
</span><span class="line"><span class="sd">    &gt;&gt;&gt; list(re_parts([first_re, second_re], &#39;This is an asdf test.&#39;))</span>
</span><span class="line"><span class="sd">    [(-1, &#39;This is &#39;), (1, &#39;an&#39;), (-1, &#39; &#39;), (0, &#39;asdf&#39;), (-1, &#39; test.&#39;)]</span>
</span><span class="line">
</span><span class="line"><span class="sd">    &gt;&gt;&gt; list(re_parts([first_re, second_re], &#39;asdfasdfasdf&#39;))</span>
</span><span class="line"><span class="sd">    [(0, &#39;asdf&#39;), (0, &#39;asdf&#39;), (0, &#39;asdf&#39;)]</span>
</span><span class="line">
</span><span class="line"><span class="sd">    &gt;&gt;&gt; list(re_parts([], &#39;This is an asdf test.&#39;))</span>
</span><span class="line"><span class="sd">    [(-1, &#39;This is an asdf test.&#39;)]</span>
</span><span class="line">
</span><span class="line"><span class="sd">    &gt;&gt;&gt; third_re = re.compile(&#39;sdf&#39;)</span>
</span><span class="line"><span class="sd">    &gt;&gt;&gt; list(re_parts([first_re, second_re, third_re], &#39;This is an asdf test.&#39;))</span>
</span><span class="line"><span class="sd">    [(-1, &#39;This is &#39;), (1, &#39;an&#39;), (-1, &#39; &#39;), (0, &#39;asdf&#39;), (-1, &#39; test.&#39;)]</span>
</span><span class="line"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">match_compare</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span class="line">        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class="line">    <span class="n">prev_end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="line">    <span class="n">iters</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regex_list</span><span class="p">]</span>
</span><span class="line">    <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="line">    <span class="k">while</span> <span class="n">iters</span><span class="p">:</span>
</span><span class="line">        <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
</span><span class="line">            <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class="line">            <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
</span><span class="line">            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">prev_end</span><span class="p">:</span>
</span><span class="line">                <span class="k">yield</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">text</span><span class="p">[</span><span class="n">prev_end</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span class="line">                <span class="k">yield</span> <span class="p">(</span><span class="n">regex_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">),</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
</span><span class="line">            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="n">prev_end</span><span class="p">:</span>
</span><span class="line">                <span class="k">yield</span> <span class="p">(</span><span class="n">regex_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">),</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
</span><span class="line">            <span class="n">prev_end</span> <span class="o">=</span> <span class="n">end</span>
</span><span class="line">        <span class="k">else</span><span class="p">:</span>
</span><span class="line">            <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="line">            <span class="k">for</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">iters</span><span class="p">:</span>
</span><span class="line">                <span class="k">try</span><span class="p">:</span>
</span><span class="line">                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iterator</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
</span><span class="line">                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span class="line">                    <span class="n">iters</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</span><span class="line">            <span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">match_compare</span><span class="p">)</span>
</span><span class="line">    <span class="n">last_bit</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">prev_end</span><span class="p">:]</span>
</span><span class="line">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_bit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="line">        <span class="k">yield</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_bit</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/04/inheritance-vs-composition/">Inheritance vs. Composition</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-04T16:12:38-07:00" pubdate data-updated="true">May 4<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately there&#8217;s been a lot of discussion in certain programming communities about which method of object extension makes more sense: inheritance, or composition.  Most of the time these discussions turn into debates, and when that happens developers tend to &quot;take sides&quot;&#8211;often moving towards extremist positions on the issue.  I&#8217;ve been sort of quietly thinking about it all lately, trying to determine which use case warrants which approach.  Here I show examples of both, explore some properties and consequences of both composition and inheritance, and finally talk about my own preferences.</p>
<div class="section" id="examples-of-composition-and-inheritance">
<h2>Examples of Composition and Inheritance</h2>
<p>Before talking about the consequences of inheritance vs. composition, some simple examples of both are needed.  Here&#8217;s a simplistic example of object composition (using Python, of course, as our demonstration language):</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">UserDetails</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="s">&quot;floguy@gmail.com&quot;</span>
</span><span class="line">    <span class="n">homepage</span> <span class="o">=</span> <span class="s">&quot;http://www.eflorenzano.com&quot;</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="s">&quot;Eric&quot;</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="s">&quot;Florenzano&quot;</span>
</span><span class="line">    <span class="n">details</span> <span class="o">=</span> <span class="n">UserDetails</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure><p>Obviously these are not very useful classes, but the essential point is that we have created a namespace for each User object, &quot;details&quot;, which contains the extra information about that particular user.</p>
<p>An example of the same objects, modified to use object inheritance might look as follows:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="n">first_name</span> <span class="o">=</span> <span class="s">&quot;Eric&quot;</span>
</span><span class="line">    <span class="n">last_name</span> <span class="o">=</span> <span class="s">&quot;Florenzano&quot;</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">UserDetails</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
</span><span class="line">    <span class="n">email</span> <span class="o">=</span> <span class="s">&quot;floguy@gmail.com&quot;</span>
</span><span class="line">    <span class="n">homepage</span> <span class="o">=</span> <span class="s">&quot;http://www.eflorenzano.com&quot;</span>
</span></code></pre></td></tr></table></div></figure><p>Now we have a flat namespace, which contains all of the attributes from both of the objects.  In the case of any collisions, Python will take the attribute from UserDetails.</p>
</div>
<div class="section" id="consequences">
<h2>Consequences</h2>
<p>From a pure programming language complexity standpoint, object composition is the simpler of the two methods.  In fact, the word &quot;object&quot; may not even apply here, as it&#8217;s possible to achieve this type of composition using structs in C, which are clearly not objects in the sense that we think of them today.</p>
<p>Another immediate thing to notice is that with composition, there&#8217;s no possibility of namespace clashes.  There&#8217;s no need to determine which attribute should &quot;win&quot;, between the object and the composed object, as each attribute remains readily available.</p>
<p>The composed object, more often than not, has no knowledge about its containing class, so it can completely encapsulate its particular functionality.  This also means that it cannot make any assumptions about its containing class, and the entire scheme can be considered less brittle.  Change an attribute or method on <tt class="docutils literal">User</tt>? That&#8217;s fine, since <tt class="docutils literal">UserDetails</tt> doesn&#8217;t know or care about <tt class="docutils literal">User</tt> at all.</p>
<p>That being said, object inheritance is arguably more straightforward.  After all, an e-mail address isn&#8217;t a logical property of some real-world object called a &quot;UserDetails&quot;.  No&#8211;it&#8217;s a property of a user&#8211;so it makes more sense to make it an attribute on our virtual equivalent, the <tt class="docutils literal">User</tt> class.</p>
<p>Object inheritance is also a more commonly-understood idea.  Asking a typical developer about object composition will most likely result in some mumbling and deflection, whereas the same question about object inheritance will probably reveal a whole host of opinions and experience.  That&#8217;s not to say that composition is some sort of dark art, but simply that it&#8217;s less commonly talked about in so many words.</p>
<p>As more of a sidenote than anything else, inheritance can be speedier in some compiled languages due to some compile-time optimizations vs. the dynamic lookup that composition requires.  Of course, in Java you can&#8217;t escape the dynamic method lookup, and in Python it&#8217;s all a moot point.</p>
</div>
<div class="section" id="my-preferences">
<h2>My Preferences</h2>
<p>In general, I find object composition to be desirable.  I&#8217;ve seen too many projects get incredibly (and unnecessarily) confusing due to complicated inheritance hierarchies.  However, there are some cases where inheritance simply makes more sense logically and programmatically.  These are typically the cases where an object has been broken into so many subcomponents that it doesn&#8217;t make sense any more as an object itself.</p>
<p>The <a class="reference external" href="http://www.djangoproject.com/">Django</a> web framework has an interesting way of dealing with model inheritance, and I think that more projects should follow its example.  It uses composition behind the scenes, and then flattens the namespace according to typical inheritance rules.  However, that composition still exists under the covers, so that that method may be used instead.</p>
<p>The answer is not going to be &quot;composition always&quot; or &quot;inheritance always&quot; or even any combination of the two, &quot;always&quot;.  Each has its own drawbacks and advantages and those should be considered before choosing an approach.  More research needs to be done on the hybrid approaches, as well, because things like what Django is doing will provide more answers to more people than traditional approaches.  Cheers to continued thought about these problems and to challenging conventional thought!</p>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/04/17/learning-design/">Learning Design</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-17T10:49:29-07:00" pubdate data-updated="true">Apr 17<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>What could have more of an impact on visitors of a website than its design?  It&#8217;s the first thing that people notice when they visit the site, and it dictates what they see and how they interact with the site.  A <a class="reference external" href="http://www.dinghyinsurance.com/">bad design</a> can drive visitors away, whereas a <a class="reference external" href="http://pownce.com/">good design</a> can bring people back again and again.</p>
<p>It seems that a common misconception is that design is how to make a site &quot;look good&quot;.  While this is true, to an extent, the design also determines the flow of information from the screen to the user.  In the words of <a class="reference external" href="http://www.andyrutledge.com/">Andy Rutledge</a>, &quot;<a class="reference external" href="http://www.andyrutledge.com/creativediscovery.php">It&#8217;s not about the design, it&#8217;s about communicating.</a>&quot;.  This only underlines the importance of good design.</p>
<p><a class="reference external" href="http://37signals.com/">37signals</a> designs their <a class="reference external" href="http://gettingreal.37signals.com/ch09_Interface_First.php">interfaces first</a>, citing two basic reasons.  First, design is lightweight relative to programming.  That is, it&#8217;s much easier to change the position of a navigation bar than to change the data persistence layer of the backend.  Second, is that the interface <em>is</em> your product&#8211;if the visitor sees and interacts and remembers the interface and its design only, then the design really <em>is</em> the site itself.  I&#8217;m not sure how much I agree with the former, as I believe that design is becoming more and more heavyweight, but the latter definitely has some merit.</p>
<p>So it&#8217;s a reasonably well-accepted fact that design is one of the most important aspects of a website, so why don&#8217;t more people focus on it?  I think that the problem is specialization:  programmers&#8211;preferring to write code and think through the program logic&#8211;attempt to muddle their way through creating a user interface, while designers&#8211;preferring to perfect the margins, whitespace, and typography&#8211;attempt to muddle their way through defining logic of the backend.</p>
<p>Of course, I&#8217;m talking about smaller projects of only one or two members.  Once they get larger than that, they need to bring a few of &quot;the other&quot; type of people into the mix.  That being said, where are the people who are excellent dual designer-developers?  Of course people like this <a class="reference external" href="http://jeffcroft.com/">exist</a>, but these people are few and far between.</p>
<p>Part of the problem is that both disciplines are ones of constant improvement.  As a developer, I know that I will never stop getting better and more experienced in my craft.  I will always look at <a class="reference external" href="http://www.eflorenzano.com/blog/post/simple-random-character-function/">code that I wrote a year ago</a> and cringe.  <strong>This is part of what makes developing interesting to developers</strong>.  As I understand it, the same is true with design.  This property of both disciplines renders learning the other discipline futile, or at least makes it seem futile (which is a bit of a self-fulfilling prophecy).</p>
<p>Is it possible to become at least conversational in the language of design, when your experience and main interests is developer?  That&#8217;s what I&#8217;ll be trying to discover in the next few weeks and months.  I don&#8217;t have more than a few hours a week to devote to it, but I&#8217;ve embarked on a bit of &quot;independent study&quot; about design, trying to learn from the best out there about grid-based layouts, color theory, etc.</p>
<p>The encouraging thing is that both designers and developers trend towards being bloggers as well, and that means that there&#8217;s a wealth of great <a class="reference external" href="http://www.alistapart.com/">articles</a> and <a class="reference external" href="http://avalonstar.com/topic/design/">information</a> out there to learn from.  Keep an eye out here for updates on my progress, my successes/frustrations, and other theoretical ramblings about design.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/04/10/lessions-learned/">Lessons Learned</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-10T10:08:40-07:00" pubdate data-updated="true">Apr 10<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yesterday I came across a quote from <a class="reference external" href="http://en.wikipedia.org/wiki/George_S._Patton">George Patton</a> (<a class="reference external" href="http://www.37signals.com/svn/posts/944-george-patton-quotes">via</a>), which stuck me as really insightful, but later something burned the quote directly into my brain.</p>
<blockquote>
&#8211;  A good plan, violently executed now, is better than a perfect plan next week.&#8211;</blockquote>
<p>It&#8217;s a quote which rings quite similar to the commonly-said open source phrase, coined by <a class="reference external" href="http://www.catb.org/~esr/">Eric S. Raymond</a> in his article <a class="reference external" href="http://www.firstmonday.org/issues/issue3_3/raymond/#d4">The Cathedral and the Bazaar</a>.</p>
<blockquote>
&quot;Release early.  Release often.&quot;</blockquote>
<p>The thing which burned these ideas into my brain is the discovery of <a class="reference external" href="http://djangoplugables.com/">djangoplugables.com</a>.  Simply put: this is an excellent site, which follows the ideas that I mentioned above completely.  The premise behind it is essentially to list all of the available django reusable applications on google code, and to display a bit of information about each app.</p>
<p>A group of about 5 people, including myself, have been silently working on a very similar site for the past month or so (the bulk of our work took place during PyCon), but we utterly failed to follow the above sentiment.  We debated for hours over how users would be able to submit applications, claim them, and how we could ensure that those claims were accurate.  We had tagging, voting, comments, voting ON comments, graphs detailing how &quot;hot&quot; each application was (based on a frequency analysis of the votes over time), and OpenID integration.</p>
<p>But all of this functionality took time, and we implemented it behind closed doors, in a vacuum&#8211;without ever seriously focusing on the user interface.  I don&#8217;t know yet what will become of all of our work, but I have a feeling that it will be discontinued in favor of the much better-looking and simpler <a class="reference external" href="http://djangoplugables.com/">djangoplugables.com</a>.  Maybe we&#8217;ll see parts of it resurface again, but that&#8217;s not really the message behind this post.  The real message to take away from this experience is that we should practice what we so often preach.  In the case of web development, execute the good plan now and iterate, versus trying to perfect everything before release.</p>
<p>The upside of all of this is that our goal has been achieved.  What we really wanted to accomplish is what now exists: an excellent resource for finding reusable django applications, and no matter who implements it, that&#8217;s a win for everyone!</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/03/31/april-fools/">April Fools</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-31T23:14:03-07:00" pubdate data-updated="true">Mar 31<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>April Fool&#8217;s Day rocks!  Maybe I enjoy it because it happens to share the same day as my birthday, but I think it&#8217;s more to do with the fact that everyone&#8217;s having fun, being lighthearted, and simply not taking things too seriously.  Last year the blog wasn&#8217;t in any shape to do anything fun for the occasion, but this year it took me about 10 minutes to whip up some middleware fun.  That&#8217;s right, if you can read and understand this right now, the secret is out: a bit of Django middleware is all that&#8217;s needed to turn your blog into l33t-sp34k central.</p>
<p>I&#8217;ll even go one step further than telling you how I did it, I&#8217;ll give you the code:</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">lxml.html</span>
</span><span class="line">
</span><span class="line"><span class="n">trans</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="s">&#39;cks&#39;</span><span class="p">:</span> <span class="s">r&#39;xxors&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;lol&#39;</span><span class="p">:</span> <span class="s">r&#39;r0flc0pt3r&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;the&#39;</span><span class="p">:</span> <span class="s">r&#39;teh&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">r&#39;4&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;e&#39;</span><span class="p">:</span> <span class="s">r&#39;3&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="s">r&#39;ph&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;g&#39;</span><span class="p">:</span> <span class="s">r&#39;6&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;h&#39;</span><span class="p">:</span> <span class="s">r&#39;|-|&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;i&#39;</span><span class="p">:</span> <span class="s">r&#39;1&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="s">r&#39;0&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="s">r&#39;5&#39;</span><span class="p">,</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">is_code_block</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span class="line">    <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;highlight&#39;</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">recursive_leetifier</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span class="line">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
</span><span class="line">        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_code_block</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
</span><span class="line">            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">trans</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
</span><span class="line">                <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="n">pattern</span><span class="p">],</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span class="line">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_code_block</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
</span><span class="line">            <span class="n">recursive_leetifier</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">LeetSpeakMiddleware</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span class="line">        <span class="k">try</span><span class="p">:</span>
</span><span class="line">            <span class="n">html</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class="line">            <span class="n">recursive_leetifier</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span class="line">            <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span class="line">        <span class="k">except</span><span class="p">:</span>
</span><span class="line">            <span class="k">pass</span>
</span><span class="line">        <span class="k">return</span> <span class="n">response</span>
</span></code></pre></td></tr></table></div></figure><p>The idea behind it is simple: Let the request go completely through Django&#8217;s request/response cycle, and just before returning the correct response, parse the HTML and convert all of the actual content to l33t by doing some simple regular expression substitution.  I&#8217;m using <a class="reference external" href="http://codespeak.net/lxml/parsing.html#parsing-html">lxml.html</a> simply because I attended <a class="reference external" href="http://blog.ianbicking.org/2008/03/21/pycon-talks/">Ian Bicking&#8217;s talk at Pycon 2008</a> and was intrigued.  I must say that the familiar <a class="reference external" href="http://docs.python.org/lib/module-xml.etree.ElementTree.html">ElementTree</a> interface helped a lot in getting this code up and running in a short amount of time.</p>
<p>Hopefully you all find this holiday to be as fun as I do, and maybe I&#8217;ll see some more l33t next year!</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/02/16/technology-behind-convore/">The Technology Behind Convore</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/10/10/object-lesson-how-respond-criticism/">An Object Lesson in How to Respond to Criticism</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/09/27/why-node-disappoints-me/">Why node.js disappoints me</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/05/20/we-need-new-word-open/">We need a new word for &#8220;Open&#8221;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/02/08/how-do-we-kick-our-synchronous-addiction/">How do we kick our synchronous addiction?</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("ericflo", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/ericflo" class="twitter-follow-button" data-show-count="false">Follow @ericflo</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/109591387819364984777?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Eric Florenzano -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
